# 프로덕션 도입을 위한 개선 사항 정리

작성일: 2026-02-10.

이 문서는 현재 PoC 구현을 기준으로, 프로덕션 레벨에서 안정적으로 운영하기 위해 필요한 개선 사항을 정리한 것이다.

## 요약

- 현재 구현은 기능 검증(PoC)에 적합하나, 보안/안정성/관측성/운영 자동화가 부족하다.
- 특히 `API 보안`, `대량 요청 대응`, `오류/지연 처리`, `비용/키 관리`, `데이터 보존/삭제 정책`은 최우선 개선 대상이다.

## 핵심 개선 포인트 (우선순위)

1. 보안과 접근 제어
- 관리자 페이지가 `?key=` 쿼리로 보호되는 방식이다. 키가 URL 히스토리/로그에 남을 수 있다.
- 개선: 세션 기반 인증, JWT, SSO, IP allowlist, 비공개 네트워크 접근 등의 대체 방식 도입.

2. 요청 제한 및 악용 방지
- `/api/generate`에 rate limiting, IP throttling, 파일 크기 제한이 없다.
- 개선: API Gateway 수준 제한, 요청당 이미지 사이즈/용량 제한, Abuse 방지 규칙 추가.

3. 대량 트래픽 대응
- 이미지 생성/편집을 요청-응답 사이클 내에서 동기 처리한다.
- 개선: 큐 기반 비동기 작업(예: Redis + worker) 도입, 결과 폴링 또는 웹훅 제공.

4. 오류 처리 및 재시도
- 외부 API 호출에서 timeout/재시도 정책이 없다.
- 개선: 호출 timeout, 지수 백오프 재시도, partial failure 대응 로직 도입.

5. 비용 가시성
- 모델 단가를 `lib/costing.ts`에 하드코딩하고 있다.
- 개선: 가격표를 DB나 설정 파일로 관리하고 변경 시 배포 없이 업데이트 가능하도록 분리.

6. 데이터 보호 및 정책
- 사용자 업로드 이미지/결과 이미지 저장 정책이 없다.
- 개선: 저장 위치(S3 등), 보존 기간, 삭제/익명화 정책 명시.

## 상세 개선 항목

### API/보안
- 요청 유효성 검증 강화
  - 파일 타입/크기 검사
  - title 길이 제한
  - prompt 길이 제한
- 키 관리
  - `OPENAI_API_KEY`, `GEMINI_API_KEY`, `ANTHROPIC_API_KEY` 누락 시 에러 메시지를 일반화 (보안 노출 최소화)
  - 비밀 관리 도구(예: Vault, AWS Secrets Manager) 도입

### 가용성/성능
- 요청당 최대 처리 시간 제한
- LLM/이미지 API 응답 지연 모니터링
- 캐싱 전략 고려 (동일 입력에 대한 재사용)

### 운영 관측성
- 현재 DB 로그만 존재. 시스템 지표/트레이싱 없음.
- 개선: 구조화 로그, 분산 트레이싱, 오류 알림(Sentry, Datadog 등) 추가

### 데이터베이스
- SQLite는 로컬 환경에 적합하나 프로덕션에는 부적합
- 개선: Postgres/MySQL 전환, 커넥션 풀링 설정

### 모델/품질 관리
- 모델 결과 품질이 일정하지 않을 수 있음
- 개선: A/B 테스트, 실패 사례 자동 수집, 피드백 루프 구축

### 프롬프트/정책
- 프롬프트가 코드에 하드코딩되어 있음
- 개선: 프롬프트 버전 관리, 실험별 파라미터 관리 도입

### 사용자 경험
- 생성 대기 중 UX 개선 필요
  - 진행 상태 표시, 단계별 상태(vision/concept/image)
  - 실패 시 재시도 안내
- 결과 다운로드/히스토리 기능 고려

## 향후 고려 사항 (프로덕션 확장 시)

- 멀티 테넌시
  - 사용자별 API 키 관리
  - 비용 분리/청구
- 감사 로그/사용량 분석
- SLA 정의 및 장애 대응 Runbook
- 콘텐츠 안전성 필터링
  - 부적절 이미지/정책 위반 감지

## 결론

현재 구현은 PoC 목적에는 충분하지만, 프로덕션 도입 전에는 보안과 운영 안정성 측면의 개선이 반드시 필요하다. 특히 인증/권한, 요청 제한, 비동기 처리, 관측성, DB 전환이 1차적으로 수행되어야 한다.
